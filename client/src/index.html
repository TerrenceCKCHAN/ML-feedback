<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>The teapot</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
        <h1>Hello</h1>
        <script src="js/three.js"></script>
        <!-- <script src="js/libs/loaders/XLoader.js"></script> -->
        
        <script type="x-shader/x-vertex" id="vertexShader">
            void main() 
            {
                vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
                gl_Position = projectionMatrix * modelViewPosition;
            }
        </script>

        <script type="x-shader/x-fragment" id="fragmentShader">
            
            void main() {
                vec4 exp = vec4(0,0,0,0);
                
                gl_FragColor = vec4(1, 0.5, 0.76, 1.0);
            }
        </script>
        
        
        <script id="canvas">	

            var loader = new THREE.ObjectLoader();
            var scene = new THREE.Scene();
            loader.load('teapot3.json', function(obj) {
                applyMaterials(obj);
                scene.add(obj);
            })

            function addShaderMaterials() {
                return new THREE.ShaderMaterial({
                    vertexShader: document.getElementById('vertexShader').textContent,
                    fragmentShader: document.getElementById('fragmentShader').textContent,
                });
            }

            function applyMaterials(obj) {
                obj.traverse(function(child) {
                if (child instanceof THREE.Mesh){
                    child.material = addShaderMaterials();
                }
                obj.needsUpdate=true;
                });
            }
            
            //LIGHTS
            var light = new THREE.AmbientLight(0xfffff, 0.5);
            scene.add(light);
            
            var pointLight = new THREE.PointLight(0xfffff,0.5);
            scene.add(pointLight);

            var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

            var renderer = new THREE.WebGLRenderer({preserveDrawingBuffer: true});
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.domElement.id = 'the_canvas'
            document.body.appendChild( renderer.domElement );
            
            var geometry = new THREE.BoxGeometry( 1, 1, 1 );
            var material = new THREE.MeshBasicMaterial( { color: 0xf0ff00 } );
            var cube = new THREE.Mesh( geometry, material );
            // scene.add( cube );
            
            camera.position.y = 2;
            camera.position.z = 10;
            
            var i = 0;
            function animate() {
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
    	        requestAnimationFrame( animate );
                renderer.render( scene, camera );
                
                if (i == 0) {
                    var canvas = renderer.view;
                    var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
                    window.location.href = image;
                }
                

            }
            animate();
            




        </script>
        
        
	</body>
</html>
